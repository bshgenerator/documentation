---
title: Utilities API
---

# Utilities API

The Utilities API provides endpoints for system utilities, trigger management, and various helper functions.

## Base Endpoint

```
{{baseUrl}}/api/utils
```

## Endpoints

### Triggers

The Triggers utility provides endpoints for managing system triggers and their associated plugins and actions.

#### Get Available Plugins

Retrieve a list of available trigger plugins.

**Endpoint:** `GET /api/utils/triggers/plugins`

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "name": "email-plugin",
      "version": "1.0.0",
      "description": "Email trigger plugin for sending notifications",
      "actions": [
        "send-email",
        "send-template-email",
        "send-bulk-email"
      ],
      "configuration": {
        "required": ["smtpHost", "smtpPort", "smtpUser", "smtpPassword"],
        "optional": ["smtpSecure", "fromEmail", "fromName"]
      }
    },
    {
      "name": "webhook-plugin",
      "version": "1.2.0",
      "description": "Webhook trigger plugin for HTTP callbacks",
      "actions": [
        "send-webhook",
        "send-get-webhook",
        "send-post-webhook"
      ],
      "configuration": {
        "required": ["url"],
        "optional": ["headers", "timeout", "retryCount"]
      }
    },
    {
      "name": "file-plugin",
      "version": "1.1.0",
      "description": "File trigger plugin for file operations",
      "actions": [
        "upload-file",
        "delete-file",
        "move-file",
        "copy-file"
      ],
      "configuration": {
        "required": ["storagePath"],
        "optional": ["allowedTypes", "maxSize", "compression"]
      }
    },
    {
      "name": "database-plugin",
      "version": "1.3.0",
      "description": "Database trigger plugin for data operations",
      "actions": [
        "insert-record",
        "update-record",
        "delete-record",
        "execute-query"
      ],
      "configuration": {
        "required": ["connectionString"],
        "optional": ["timeout", "poolSize", "sslMode"]
      }
    }
  ]
}
```

#### Get Available Actions

Retrieve a list of available trigger actions across all plugins.

**Endpoint:** `GET /api/utils/triggers/actions`

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "name": "send-email",
      "plugin": "email-plugin",
      "description": "Send a single email",
      "parameters": {
        "to": {
          "type": "string",
          "required": true,
          "description": "Recipient email address"
        },
        "subject": {
          "type": "string",
          "required": true,
          "description": "Email subject"
        },
        "body": {
          "type": "string",
          "required": true,
          "description": "Email body content"
        },
        "html": {
          "type": "boolean",
          "required": false,
          "default": false,
          "description": "Whether body is HTML"
        }
      },
      "output": {
        "type": "object",
        "properties": {
          "messageId": "string",
          "status": "string",
          "sentAt": "datetime"
        }
      }
    },
    {
      "name": "send-template-email",
      "plugin": "email-plugin",
      "description": "Send email using a template",
      "parameters": {
        "to": {
          "type": "string",
          "required": true,
          "description": "Recipient email address"
        },
        "template": {
          "type": "string",
          "required": true,
          "description": "Template name"
        },
        "data": {
          "type": "object",
          "required": true,
          "description": "Template variables"
        }
      },
      "output": {
        "type": "object",
        "properties": {
          "messageId": "string",
          "status": "string",
          "sentAt": "datetime"
        }
      }
    },
    {
      "name": "send-webhook",
      "plugin": "webhook-plugin",
      "description": "Send HTTP webhook",
      "parameters": {
        "url": {
          "type": "string",
          "required": true,
          "description": "Webhook URL"
        },
        "method": {
          "type": "string",
          "required": false,
          "default": "POST",
          "description": "HTTP method"
        },
        "headers": {
          "type": "object",
          "required": false,
          "description": "HTTP headers"
        },
        "body": {
          "type": "object",
          "required": false,
          "description": "Request body"
        },
        "timeout": {
          "type": "number",
          "required": false,
          "default": 30,
          "description": "Request timeout in seconds"
        }
      },
      "output": {
        "type": "object",
        "properties": {
          "statusCode": "number",
          "response": "object",
          "executedAt": "datetime"
        }
      }
    },
    {
      "name": "upload-file",
      "plugin": "file-plugin",
      "description": "Upload a file to storage",
      "parameters": {
        "file": {
          "type": "file",
          "required": true,
          "description": "File to upload"
        },
        "path": {
          "type": "string",
          "required": true,
          "description": "Storage path"
        },
        "metadata": {
          "type": "object",
          "required": false,
          "description": "File metadata"
        }
      },
      "output": {
        "type": "object",
        "properties": {
          "fileId": "string",
          "url": "string",
          "size": "number",
          "uploadedAt": "datetime"
        }
      }
    },
    {
      "name": "insert-record",
      "plugin": "database-plugin",
      "description": "Insert a record into database",
      "parameters": {
        "table": {
          "type": "string",
          "required": true,
          "description": "Database table name"
        },
        "data": {
          "type": "object",
          "required": true,
          "description": "Record data"
        }
      },
      "output": {
        "type": "object",
        "properties": {
          "id": "string",
          "insertedAt": "datetime"
        }
      }
    }
  ]
}
```

## Trigger System

### Overview

The trigger system allows you to create automated workflows that respond to events in your application. Triggers can execute various actions based on conditions and data.

### Trigger Types

#### Event-Based Triggers
Triggers that respond to specific events:

```javascript
// User registration trigger
const userRegistrationTrigger = {
  name: "user-registration-trigger",
  event: "user.created",
  conditions: [
    {
      field: "user.role",
      operator: "eq",
      value: "premium"
    }
  ],
  actions: [
    {
      plugin: "email-plugin",
      action: "send-template-email",
      parameters: {
        to: "{{user.email}}",
        template: "welcome-premium",
        data: {
          userName: "{{user.name}}",
          loginUrl: "{{app.loginUrl}}"
        }
      }
    }
  ]
};
```

#### Time-Based Triggers
Triggers that execute on a schedule:

```javascript
// Daily report trigger
const dailyReportTrigger = {
  name: "daily-report-trigger",
  schedule: "0 9 * * *", // 9 AM daily
  actions: [
    {
      plugin: "email-plugin",
      action: "send-template-email",
      parameters: {
        to: "admin@example.com",
        template: "daily-report",
        data: {
          date: "{{currentDate}}",
          stats: "{{dailyStats}}"
        }
      }
    }
  ]
};
```

#### Data-Based Triggers
Triggers that respond to data changes:

```javascript
// Low inventory trigger
const lowInventoryTrigger = {
  name: "low-inventory-trigger",
  event: "product.updated",
  conditions: [
    {
      field: "product.stock",
      operator: "lt",
      value: 10
    }
  ],
  actions: [
    {
      plugin: "webhook-plugin",
      action: "send-webhook",
      parameters: {
        url: "https://inventory-system.com/webhook",
        method: "POST",
        body: {
          productId: "{{product.id}}",
          currentStock: "{{product.stock}}",
          alertLevel: "low"
        }
      }
    }
  ]
};
```

### Action Parameters

Actions support various parameter types and can use template variables:

#### String Parameters
```javascript
{
  "to": "user@example.com",
  "subject": "Welcome {{user.name}}"
}
```

#### Object Parameters
```javascript
{
  "data": {
    "userName": "{{user.name}}",
    "userId": "{{user.id}}",
    "timestamp": "{{currentTimestamp}}"
  }
}
```

#### Conditional Parameters
```javascript
{
  "template": "{{#if user.isPremium}}premium-welcome{{else}}standard-welcome{{/if}}"
}
```

#### Array Parameters
```javascript
{
  "recipients": [
    "{{user.email}}",
    "{{user.manager.email}}"
  ]
}
```

### Template Variables

Triggers support template variables for dynamic content:

#### System Variables
- `{{currentDate}}` - Current date
- `{{currentTime}}` - Current timestamp
- `{{currentUser}}` - Current user context
- `{{app.baseUrl}}` - Application base URL

#### Event Variables
- `{{event.type}}` - Event type
- `{{event.data}}` - Event data
- `{{event.timestamp}}` - Event timestamp

#### Entity Variables
- `{{entity.id}}` - Entity ID
- `{{entity.name}}` - Entity name
- `{{entity.createdAt}}` - Entity creation date

#### Custom Variables
- `{{user.name}}` - User name
- `{{product.price}}` - Product price
- `{{order.total}}` - Order total

## Plugin Development

### Creating Custom Plugins

Plugins can be developed to extend the trigger system:

#### Plugin Structure
```javascript
// Custom plugin example
const customPlugin = {
  name: "custom-plugin",
  version: "1.0.0",
  description: "Custom plugin for specific business logic",
  actions: [
    {
      name: "custom-action",
      description: "Custom action description",
      parameters: {
        param1: {
          type: "string",
          required: true,
          description: "Parameter description"
        }
      },
      execute: async (parameters, context) => {
        // Custom logic here
        return {
          success: true,
          result: "Action completed"
        };
      }
    }
  ]
};
```

#### Plugin Configuration
```javascript
// Plugin configuration schema
const pluginConfig = {
  name: "email-plugin",
  configuration: {
    smtpHost: {
      type: "string",
      required: true,
      description: "SMTP server host"
    },
    smtpPort: {
      type: "number",
      required: true,
      default: 587,
      description: "SMTP server port"
    },
    smtpUser: {
      type: "string",
      required: true,
      description: "SMTP username"
    },
    smtpPassword: {
      type: "string",
      required: true,
      sensitive: true,
      description: "SMTP password"
    }
  }
};
```

## Error Handling

### Common Error Responses

#### Plugin Not Found
```json
{
  "success": false,
  "error": {
    "code": "PLUGIN_NOT_FOUND",
    "message": "Plugin not found",
    "details": {
      "plugin": "nonexistent-plugin"
    }
  }
}
```

#### Action Not Found
```json
{
  "success": false,
  "error": {
    "code": "ACTION_NOT_FOUND",
    "message": "Action not found",
    "details": {
      "action": "nonexistent-action",
      "plugin": "email-plugin"
    }
  }
}
```

#### Invalid Parameters
```json
{
  "success": false,
  "error": {
    "code": "INVALID_PARAMETERS",
    "message": "Invalid action parameters",
    "details": {
      "action": "send-email",
      "errors": [
        {
          "field": "to",
          "message": "Email address is required"
        }
      ]
    }
  }
}
```

#### Plugin Execution Error
```json
{
  "success": false,
  "error": {
    "code": "PLUGIN_EXECUTION_ERROR",
    "message": "Plugin execution failed",
    "details": {
      "plugin": "email-plugin",
      "action": "send-email",
      "reason": "SMTP connection failed"
    }
  }
}
```

## Best Practices

### Trigger Design

1. **Keep triggers simple**: Each trigger should have a single responsibility
2. **Use conditions wisely**: Add appropriate conditions to prevent unnecessary executions
3. **Handle errors gracefully**: Implement proper error handling in actions
4. **Test thoroughly**: Test triggers with various data scenarios

### Performance Considerations

1. **Limit action complexity**: Keep actions lightweight and fast
2. **Use async operations**: Use asynchronous operations for I/O-bound tasks
3. **Implement timeouts**: Set appropriate timeouts for external calls
4. **Monitor execution**: Monitor trigger execution performance

### Security

1. **Validate inputs**: Always validate action parameters
2. **Sanitize data**: Sanitize user data before using in templates
3. **Secure credentials**: Store plugin credentials securely
4. **Access control**: Implement proper access control for trigger management

## Example Implementation

```javascript
class TriggerManager {
  constructor(apiBaseUrl, accessToken) {
    this.apiBaseUrl = apiBaseUrl;
    this.accessToken = accessToken;
  }

  async getAvailablePlugins() {
    try {
      const response = await fetch(`${this.apiBaseUrl}/api/utils/triggers/plugins`, {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`
        }
      });

      const result = await response.json();
      return result.data;
    } catch (error) {
      console.error('Failed to get plugins:', error);
      throw error;
    }
  }

  async getAvailableActions() {
    try {
      const response = await fetch(`${this.apiBaseUrl}/api/utils/triggers/actions`, {
        headers: {
          'Authorization': `Bearer ${this.accessToken}`
        }
      });

      const result = await response.json();
      return result.data;
    } catch (error) {
      console.error('Failed to get actions:', error);
      throw error;
    }
  }

  async createTrigger(triggerConfig) {
    // This would be implemented based on the actual trigger creation endpoint
    try {
      const response = await fetch(`${this.apiBaseUrl}/api/triggers`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(triggerConfig)
      });

      const result = await response.json();
      return result.data;
    } catch (error) {
      console.error('Failed to create trigger:', error);
      throw error;
    }
  }

  async executeAction(plugin, action, parameters) {
    // This would be implemented based on the actual action execution endpoint
    try {
      const response = await fetch(`${this.apiBaseUrl}/api/triggers/execute`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${this.accessToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          plugin,
          action,
          parameters
        })
      });

      const result = await response.json();
      return result.data;
    } catch (error) {
      console.error('Failed to execute action:', error);
      throw error;
    }
  }
}

// Usage
const triggerManager = new TriggerManager('http://localhost:7071', accessToken);

// Get available plugins
const plugins = await triggerManager.getAvailablePlugins();
console.log('Available plugins:', plugins);

// Get available actions
const actions = await triggerManager.getAvailableActions();
console.log('Available actions:', actions);

// Create a trigger
const trigger = await triggerManager.createTrigger({
  name: "user-welcome-trigger",
  event: "user.created",
  actions: [
    {
      plugin: "email-plugin",
      action: "send-template-email",
      parameters: {
        to: "{{user.email}}",
        template: "welcome",
        data: {
          userName: "{{user.name}}"
        }
      }
    }
  ]
});

// Execute an action directly
const result = await triggerManager.executeAction(
  "email-plugin",
  "send-email",
  {
    to: "user@example.com",
    subject: "Test Email",
    body: "This is a test email"
  }
);
```

## Rate Limiting

Utilities endpoints are subject to rate limiting:

- **Plugin queries:** 100 requests per minute
- **Action queries:** 100 requests per minute
- **Action execution:** 50 requests per minute

Check response headers for current limits:
- `X-RateLimit-Limit`
- `X-RateLimit-Remaining`
- `X-RateLimit-Reset`
