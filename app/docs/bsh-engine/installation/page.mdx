import { Tabs, Steps, Callout } from 'nextra/components';
import { Cards } from 'nextra/components';
import PostmanIcon from '../../../../tech-icons/PostmanIcon';

# Installation

## Prerequisites

- Docker
- Docker Compose

## Installation

<Steps>
### Docker Compose File
Create a new file called `docker-compose.yml` in the root of your project

<Tabs items={['Without Database', 'With Database']}>
    <Tabs.Tab title="Without Database">
```yaml filename="docker-compose.yml" {3}
services:
  backend:
    image: 'bshg/engine:latest'
    container_name: 'engine-backend'
    ports:
      - '7071:7071'
    env_file:
      - .env
```
    </Tabs.Tab>
    <Tabs.Tab title="Database Included">
```yaml filename="docker-compose.yml" {3} {15}
services:
  backend:
    image: 'bshg/engine:latest'
    container_name: 'engine-backend'
    ports:
      - '7071:7071'
    env_file:
      - .env
    depends_on:
      - postgres
    networks:
      - engine-net

  postgres:
    image: 'postgres:latest'
    container_name: 'engine-postgres'
    environment:
      - 'POSTGRES_DB=engine'
      - 'POSTGRES_PASSWORD=password'
      - 'PGDATA=/var/lib/postgresql/data'
      - 'POSTGRES_USER=engine'
    ports:
      - '5432:5432'
    volumes:
      - ./data/engine-postgres-data:/var/lib/postgresql/data
    networks:
      - engine-net

networks:
  engine-net:
    name: engine-net
    driver: bridge

volumes:
  engine-postgres-data:
```
    </Tabs.Tab>
</Tabs>

### Environment Variables

Create a new file called `.env` in the root of your project and copy the following code into it:

```dotenv filename=".env"
BSH_DB_URL=jdbc:postgresql://engine-postgres:5432/engine
BSH_DB_USER=engine
BSH_DB_PASSWORD=password
BSH_DB_DRIVER=org.postgresql.Driver

BSH_PORT=7071 # optional
BSH_FRONTEND_HOST=http://localhost:*

BSH_ADMIN_USERNAME=admin@engine.com
BSH_ADMIN_PASSWORD=password

BSH_CORE_INSTALL=true # optional
```

adjust the environment variables to your needs.

<Callout type="warning">
    - `BSH_FRONTEND_HOST` should be the same as the frontend host or any other host that you want to access the engine from.
    - `BSH_ADMIN_USERNAME` and `BSH_ADMIN_PASSWORD` are the credentials for the admin user. It will be created automatically when the engine starts.
</Callout>

> **❗`BSH_CORE_INSTALL`**
>
> - `BSH_CORE_INSTALL` controls whether the core plugin and its initial configuration are installed when starting the engine.
> - For first-time setup, set `BSH_CORE_INSTALL=true` (default). This creates core resources, including a default admin user and roles.
> - **Important:** If you make manual changes to core configurations, set `BSH_CORE_INSTALL=false` *before* restarting the engine. This prevents your manual changes from being overwritten.


### Run the Engine

Run the following command to start the engine:

```bash
docker compose up -d
```

<Callout type="info">
    The engine will be available at `http://localhost:7071`
</Callout>

### Explore the Endpoints

After the engine is running, you can fork the **BSH Engine** Postman collection from the `postman` workspace to use the exposed endpoints. You can also import the collection into your own Postman workspace.

<Cards>
    <Cards.Card icon={<PostmanIcon />} title='BSH Engine Collection' href='https://www.postman.com/altimetry-participant-52635096/bsh-engine/collection/f5p3buz/bsh-engine' target='_blank' />
</Cards>

<Callout type="info">
    The collection is updated when the engine is updated.
</Callout>

</Steps>
